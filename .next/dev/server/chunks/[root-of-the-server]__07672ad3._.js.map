{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/sonamjsherpa/Desktop/ngimalaya-adventure/utils/phoneFormatter.ts"],"sourcesContent":["/**\n * Phone number formatting utilities\n */\n\n/**\n * Format phone number to XXX-XXX-XXXX format\n * Handles various input formats and international numbers\n * \n * @param phone - Raw phone number input (can include spaces, dashes, parentheses, +)\n * @returns Formatted phone number in XXX-XXX-XXXX format, or original if can't format\n */\nexport function formatPhoneNumber(phone: string): string {\n  if (!phone) return '';\n  \n  // Remove all non-digit characters except leading +\n  const cleaned = phone.replace(/[^\\d+]/g, '');\n  \n  // Remove leading + or country codes (1, +1, etc.)\n  let digits = cleaned.replace(/^\\+?1?/, '');\n  \n  // If we have exactly 10 digits, format as XXX-XXX-XXXX\n  if (digits.length === 10) {\n    return `${digits.slice(0, 3)}-${digits.slice(3, 6)}-${digits.slice(6)}`;\n  }\n  \n  // If we have 11 digits and starts with 1, remove the 1 and format\n  if (digits.length === 11 && digits.startsWith('1')) {\n    digits = digits.slice(1);\n    return `${digits.slice(0, 3)}-${digits.slice(3, 6)}-${digits.slice(6)}`;\n  }\n  \n  // For international numbers or other formats, return original with some cleanup\n  if (digits.length > 10) {\n    // Keep the original format for international numbers\n    return phone.trim();\n  }\n  \n  // For shorter numbers, just clean them up\n  return digits || phone;\n}\n\n/**\n * Validate if phone number has enough digits\n * @param phone - Phone number to validate\n * @returns true if valid (has at least 10 digits)\n */\nexport function isValidPhoneNumber(phone: string): boolean {\n  if (!phone) return false;\n  const digits = phone.replace(/\\D/g, '');\n  return digits.length >= 10;\n}\n\n/**\n * Format phone number for display with country code\n * @param phone - Raw phone number\n * @param countryCode - Country code (default: +1 for US/Canada)\n * @returns Formatted as +1 (XXX) XXX-XXXX\n */\nexport function formatPhoneWithCountryCode(phone: string, countryCode: string = '+1'): string {\n  const formatted = formatPhoneNumber(phone);\n  \n  if (formatted.match(/^\\d{3}-\\d{3}-\\d{4}$/)) {\n    const parts = formatted.split('-');\n    return `${countryCode} (${parts[0]}) ${parts[1]}-${parts[2]}`;\n  }\n  \n  return phone;\n}\n"],"names":[],"mappings":"AAAA;;CAEC,GAED;;;;;;CAMC;;;;;;;;AACM,SAAS,kBAAkB,KAAa;IAC7C,IAAI,CAAC,OAAO,OAAO;IAEnB,mDAAmD;IACnD,MAAM,UAAU,MAAM,OAAO,CAAC,WAAW;IAEzC,kDAAkD;IAClD,IAAI,SAAS,QAAQ,OAAO,CAAC,UAAU;IAEvC,uDAAuD;IACvD,IAAI,OAAO,MAAM,KAAK,IAAI;QACxB,OAAO,GAAG,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,IAAI;IACzE;IAEA,kEAAkE;IAClE,IAAI,OAAO,MAAM,KAAK,MAAM,OAAO,UAAU,CAAC,MAAM;QAClD,SAAS,OAAO,KAAK,CAAC;QACtB,OAAO,GAAG,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,IAAI;IACzE;IAEA,gFAAgF;IAChF,IAAI,OAAO,MAAM,GAAG,IAAI;QACtB,qDAAqD;QACrD,OAAO,MAAM,IAAI;IACnB;IAEA,0CAA0C;IAC1C,OAAO,UAAU;AACnB;AAOO,SAAS,mBAAmB,KAAa;IAC9C,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,SAAS,MAAM,OAAO,CAAC,OAAO;IACpC,OAAO,OAAO,MAAM,IAAI;AAC1B;AAQO,SAAS,2BAA2B,KAAa,EAAE,cAAsB,IAAI;IAClF,MAAM,YAAY,kBAAkB;IAEpC,IAAI,UAAU,KAAK,CAAC,wBAAwB;QAC1C,MAAM,QAAQ,UAAU,KAAK,CAAC;QAC9B,OAAO,GAAG,YAAY,EAAE,EAAE,KAAK,CAAC,EAAE,CAAC,EAAE,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE;IAC/D;IAEA,OAAO;AACT"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/sonamjsherpa/Desktop/ngimalaya-adventure/app/api/contact/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport sgMail from '@sendgrid/mail';\nimport { formatPhoneNumber } from '@/utils/phoneFormatter';\n\n// Initialize SendGrid\nsgMail.setApiKey(process.env.SENDGRID_API_KEY || '');\n\ninterface ContactData {\n  name: string;\n  email: string;\n  phone?: string;\n  subject: string;\n  message: string;\n  // Honeypot field\n  website?: string;\n}\n\n// Email validation regex\nconst EMAIL_REGEX = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n\n// Disposable email domains to block\nconst DISPOSABLE_DOMAINS = [\n  'tempmail.com', 'throwaway.email', 'guerrillamail.com', 'mailinator.com',\n  '10minutemail.com', 'trashmail.com', 'temp-mail.org', 'yopmail.com',\n  'sharklasers.com', 'maildrop.cc', 'getnada.com', 'fakeinbox.com',\n  'spamgourmet.com', 'tempinbox.com'\n];\n\n// Suspicious patterns for XSS, SQL injection, etc.\nconst SUSPICIOUS_PATTERNS = [\n  /<script/i,\n  /javascript:/i,\n  /on\\w+=/i,\n  /<iframe/i,\n  /eval\\(/i,\n  /onclick/i,\n  /onerror/i,\n  /data:text\\/html/i,\n  /<object/i,\n  /<embed/i\n];\n\n// Rate limiting map\nconst rateLimitMap = new Map<string, { count: number; timestamp: number }>();\nconst RATE_LIMIT_WINDOW = 60 * 60 * 1000; // 1 hour\nconst MAX_REQUESTS_PER_WINDOW = 5;\n\nfunction validateEmail(email: string): boolean {\n  if (!EMAIL_REGEX.test(email)) return false;\n  \n  const domain = email.split('@')[1]?.toLowerCase();\n  if (DISPOSABLE_DOMAINS.includes(domain)) return false;\n  \n  return true;\n}\n\nfunction sanitizeInput(input: string): string {\n  const sanitized = input.replace(/<[^>]*>/g, '');\n  \n  for (const pattern of SUSPICIOUS_PATTERNS) {\n    if (pattern.test(sanitized)) {\n      throw new Error('Suspicious content detected');\n    }\n  }\n  \n  return sanitized.trim();\n}\n\nfunction checkRateLimit(identifier: string): boolean {\n  const now = Date.now();\n  const record = rateLimitMap.get(identifier);\n  \n  if (!record) {\n    rateLimitMap.set(identifier, { count: 1, timestamp: now });\n    return true;\n  }\n  \n  if (now - record.timestamp > RATE_LIMIT_WINDOW) {\n    rateLimitMap.set(identifier, { count: 1, timestamp: now });\n    return true;\n  }\n  \n  if (record.count >= MAX_REQUESTS_PER_WINDOW) {\n    return false;\n  }\n  \n  record.count++;\n  return true;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const clientIP = request.headers.get('x-forwarded-for') || \n                     request.headers.get('x-real-ip') || \n                     'unknown';\n    \n    if (!checkRateLimit(clientIP)) {\n      return NextResponse.json(\n        { error: 'Too many requests. Please try again later.' },\n        { status: 429 }\n      );\n    }\n    \n    const data: ContactData = await request.json();\n    \n    // Honeypot check\n    if (data.website) {\n      console.log('Bot detected via honeypot');\n      return NextResponse.json({ success: true });\n    }\n    \n    // Validate required fields\n    if (!data.name || !data.email || !data.subject || !data.message) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n    \n    // Validate email\n    if (!validateEmail(data.email)) {\n      return NextResponse.json(\n        { error: 'Invalid or disposable email address' },\n        { status: 400 }\n      );\n    }\n    \n    // Sanitize inputs\n    const sanitizedData = {\n      name: sanitizeInput(data.name),\n      email: sanitizeInput(data.email),\n      phone: data.phone ? formatPhoneNumber(sanitizeInput(data.phone)) : '',\n      subject: sanitizeInput(data.subject),\n      message: sanitizeInput(data.message),\n    };\n    \n    // Create email content\n    const emailContent = {\n      to: process.env.NGIMALAYA_EMAIL || 'ngiman81@gmail.com',\n      from: {\n        email: process.env.NGIMALAYA_EMAIL || 'ngiman81@gmail.com',\n        name: 'Ngimalaya Adventure Contact Form'\n      },\n      replyTo: sanitizedData.email,\n      subject: `Contact Form: ${sanitizedData.subject}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n            .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }\n            .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }\n            .field { margin-bottom: 12px; }\n            .label { font-weight: bold; color: #555; }\n            .value { color: #333; margin-top: 5px; }\n            .message-box { background: #f8f9fa; padding: 15px; border-left: 4px solid #667eea; margin: 15px 0; }\n            .footer { text-align: center; margin-top: 20px; color: #666; font-size: 12px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>ðŸ“§ New Contact Form Submission</h1>\n              <p>Received: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Kathmandu' })} NPT</p>\n            </div>\n            \n            <div class=\"content\">\n              <div class=\"section\">\n                <div class=\"field\">\n                  <div class=\"label\">From:</div>\n                  <div class=\"value\">${sanitizedData.name}</div>\n                </div>\n                <div class=\"field\">\n                  <div class=\"label\">Email:</div>\n                  <div class=\"value\"><a href=\"mailto:${sanitizedData.email}\">${sanitizedData.email}</a></div>\n                </div>\n                ${sanitizedData.phone ? `\n                <div class=\"field\">\n                  <div class=\"label\">Phone:</div>\n                  <div class=\"value\">${sanitizedData.phone}</div>\n                </div>\n                ` : ''}\n                <div class=\"field\">\n                  <div class=\"label\">Subject:</div>\n                  <div class=\"value\"><strong>${sanitizedData.subject}</strong></div>\n                </div>\n              </div>\n              \n              <div class=\"message-box\">\n                <div class=\"label\">Message:</div>\n                <div class=\"value\" style=\"white-space: pre-wrap;\">${sanitizedData.message}</div>\n              </div>\n              \n              <div class=\"footer\">\n                <p>This email was sent from Ngimalaya Adventure contact form</p>\n                <p>IP Address: ${clientIP}</p>\n              </div>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n      text: `\nNew Contact Form Submission\n\nFrom: ${sanitizedData.name}\nEmail: ${sanitizedData.email}\n${sanitizedData.phone ? `Phone: ${sanitizedData.phone}` : ''}\nSubject: ${sanitizedData.subject}\n\nMessage:\n${sanitizedData.message}\n\nReceived: ${new Date().toLocaleString()}\nIP Address: ${clientIP}\n      `\n    };\n    \n    await sgMail.send(emailContent);\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Message sent successfully'\n    });\n    \n  } catch (error: unknown) {\n    console.error('Contact API Error:', error);\n    \n    if (error instanceof Error && error.message === 'Suspicious content detected') {\n      return NextResponse.json(\n        { error: 'Invalid input detected' },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to send message. Please try again.' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}