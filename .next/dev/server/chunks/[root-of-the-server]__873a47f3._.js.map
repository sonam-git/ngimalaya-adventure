{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///Users/sonamjsherpa/Desktop/ngimalaya-adventure/utils/phoneFormatter.ts"],"sourcesContent":["/**\n * Phone number formatting utilities\n */\n\n/**\n * Format phone number to XXX-XXX-XXXX format\n * Handles various input formats and international numbers\n * \n * @param phone - Raw phone number input (can include spaces, dashes, parentheses, +)\n * @returns Formatted phone number in XXX-XXX-XXXX format, or original if can't format\n */\nexport function formatPhoneNumber(phone: string): string {\n  if (!phone) return '';\n  \n  // Remove all non-digit characters except leading +\n  const cleaned = phone.replace(/[^\\d+]/g, '');\n  \n  // Remove leading + or country codes (1, +1, etc.)\n  let digits = cleaned.replace(/^\\+?1?/, '');\n  \n  // If we have exactly 10 digits, format as XXX-XXX-XXXX\n  if (digits.length === 10) {\n    return `${digits.slice(0, 3)}-${digits.slice(3, 6)}-${digits.slice(6)}`;\n  }\n  \n  // If we have 11 digits and starts with 1, remove the 1 and format\n  if (digits.length === 11 && digits.startsWith('1')) {\n    digits = digits.slice(1);\n    return `${digits.slice(0, 3)}-${digits.slice(3, 6)}-${digits.slice(6)}`;\n  }\n  \n  // For international numbers or other formats, return original with some cleanup\n  if (digits.length > 10) {\n    // Keep the original format for international numbers\n    return phone.trim();\n  }\n  \n  // For shorter numbers, just clean them up\n  return digits || phone;\n}\n\n/**\n * Validate if phone number has enough digits\n * @param phone - Phone number to validate\n * @returns true if valid (has at least 10 digits)\n */\nexport function isValidPhoneNumber(phone: string): boolean {\n  if (!phone) return false;\n  const digits = phone.replace(/\\D/g, '');\n  return digits.length >= 10;\n}\n\n/**\n * Format phone number for display with country code\n * @param phone - Raw phone number\n * @param countryCode - Country code (default: +1 for US/Canada)\n * @returns Formatted as +1 (XXX) XXX-XXXX\n */\nexport function formatPhoneWithCountryCode(phone: string, countryCode: string = '+1'): string {\n  const formatted = formatPhoneNumber(phone);\n  \n  if (formatted.match(/^\\d{3}-\\d{3}-\\d{4}$/)) {\n    const parts = formatted.split('-');\n    return `${countryCode} (${parts[0]}) ${parts[1]}-${parts[2]}`;\n  }\n  \n  return phone;\n}\n"],"names":[],"mappings":"AAAA;;CAEC,GAED;;;;;;CAMC;;;;;;;;AACM,SAAS,kBAAkB,KAAa;IAC7C,IAAI,CAAC,OAAO,OAAO;IAEnB,mDAAmD;IACnD,MAAM,UAAU,MAAM,OAAO,CAAC,WAAW;IAEzC,kDAAkD;IAClD,IAAI,SAAS,QAAQ,OAAO,CAAC,UAAU;IAEvC,uDAAuD;IACvD,IAAI,OAAO,MAAM,KAAK,IAAI;QACxB,OAAO,GAAG,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,IAAI;IACzE;IAEA,kEAAkE;IAClE,IAAI,OAAO,MAAM,KAAK,MAAM,OAAO,UAAU,CAAC,MAAM;QAClD,SAAS,OAAO,KAAK,CAAC;QACtB,OAAO,GAAG,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,GAAG,GAAG,CAAC,EAAE,OAAO,KAAK,CAAC,IAAI;IACzE;IAEA,gFAAgF;IAChF,IAAI,OAAO,MAAM,GAAG,IAAI;QACtB,qDAAqD;QACrD,OAAO,MAAM,IAAI;IACnB;IAEA,0CAA0C;IAC1C,OAAO,UAAU;AACnB;AAOO,SAAS,mBAAmB,KAAa;IAC9C,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,SAAS,MAAM,OAAO,CAAC,OAAO;IACpC,OAAO,OAAO,MAAM,IAAI;AAC1B;AAQO,SAAS,2BAA2B,KAAa,EAAE,cAAsB,IAAI;IAClF,MAAM,YAAY,kBAAkB;IAEpC,IAAI,UAAU,KAAK,CAAC,wBAAwB;QAC1C,MAAM,QAAQ,UAAU,KAAK,CAAC;QAC9B,OAAO,GAAG,YAAY,EAAE,EAAE,KAAK,CAAC,EAAE,CAAC,EAAE,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE;IAC/D;IAEA,OAAO;AACT"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/sonamjsherpa/Desktop/ngimalaya-adventure/app/api/inquiry/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport sgMail from '@sendgrid/mail';\nimport { formatPhoneNumber } from '@/utils/phoneFormatter';\n\nsgMail.setApiKey(process.env.SENDGRID_API_KEY || '');\n\ninterface InquiryData {\n  fullName: string;\n  email: string;\n  phone?: string;\n  subject: string;\n  message: string;\n  // Honeypot field\n  website?: string;\n}\n\nconst EMAIL_REGEX = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n\nconst DISPOSABLE_DOMAINS = [\n  'tempmail.com', 'throwaway.email', 'guerrillamail.com', 'mailinator.com',\n  '10minutemail.com', 'trashmail.com', 'temp-mail.org', 'yopmail.com',\n  'sharklasers.com', 'maildrop.cc', 'getnada.com', 'fakeinbox.com',\n  'spamgourmet.com', 'tempinbox.com', 'dispostable.com', 'burnermail.io'\n];\n\nconst SUSPICIOUS_PATTERNS = [\n  /<script/i,\n  /javascript:/i,\n  /on\\w+=/i,\n  /<iframe/i,\n  /eval\\(/i,\n  /onclick/i,\n  /onerror/i,\n  /data:text\\/html/i,\n  /<object/i,\n  /<embed/i,\n  /vbscript:/i\n];\n\nconst rateLimitMap = new Map<string, { count: number; timestamp: number }>();\nconst RATE_LIMIT_WINDOW = 60 * 60 * 1000;\nconst MAX_REQUESTS_PER_WINDOW = 5;\n\nfunction validateEmail(email: string): boolean {\n  if (!EMAIL_REGEX.test(email)) return false;\n  const domain = email.split('@')[1]?.toLowerCase();\n  if (DISPOSABLE_DOMAINS.includes(domain)) return false;\n  return true;\n}\n\nfunction sanitizeInput(input: string): string {\n  const sanitized = input.replace(/<[^>]*>/g, '');\n  \n  for (const pattern of SUSPICIOUS_PATTERNS) {\n    if (pattern.test(sanitized)) {\n      throw new Error('Suspicious content detected');\n    }\n  }\n  \n  return sanitized.trim();\n}\n\nfunction checkRateLimit(identifier: string): boolean {\n  const now = Date.now();\n  const record = rateLimitMap.get(identifier);\n  \n  if (!record) {\n    rateLimitMap.set(identifier, { count: 1, timestamp: now });\n    return true;\n  }\n  \n  if (now - record.timestamp > RATE_LIMIT_WINDOW) {\n    rateLimitMap.set(identifier, { count: 1, timestamp: now });\n    return true;\n  }\n  \n  if (record.count >= MAX_REQUESTS_PER_WINDOW) {\n    return false;\n  }\n  \n  record.count++;\n  return true;\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const clientIP = request.headers.get('x-forwarded-for') || \n                     request.headers.get('x-real-ip') || \n                     'unknown';\n    \n    if (!checkRateLimit(clientIP)) {\n      return NextResponse.json(\n        { error: 'Too many requests. Please try again later.' },\n        { status: 429 }\n      );\n    }\n    \n    const data: InquiryData = await request.json();\n    \n    // Honeypot check\n    if (data.website) {\n      console.log('Bot detected via honeypot');\n      return NextResponse.json({ success: true });\n    }\n    \n    // Validate required fields\n    if (!data.fullName || !data.email || !data.subject || !data.message) {\n      return NextResponse.json(\n        { error: 'Missing required fields' },\n        { status: 400 }\n      );\n    }\n    \n    // Validate email\n    if (!validateEmail(data.email)) {\n      return NextResponse.json(\n        { error: 'Invalid or disposable email address' },\n        { status: 400 }\n      );\n    }\n    \n    // Sanitize inputs\n    const sanitizedData = {\n      fullName: sanitizeInput(data.fullName),\n      email: sanitizeInput(data.email),\n      phone: data.phone ? formatPhoneNumber(sanitizeInput(data.phone)) : '',\n      subject: sanitizeInput(data.subject),\n      message: sanitizeInput(data.message),\n    };\n    \n    // Determine subject category for better routing\n    const subjectCategories = {\n      'General Inquiry': 'üìã',\n      'Trek Information': 'üèîÔ∏è',\n      'Booking Assistance': 'üìÖ',\n      'Group Trek Planning': 'üë•',\n      'Equipment Rental': 'üéí',\n      'Travel Insurance': 'üõ°Ô∏è',\n      'Custom Itinerary': 'üó∫Ô∏è',\n      'Safety & Preparation': '‚ö†Ô∏è',\n      'Other': 'üí¨'\n    };\n    \n    const subjectIcon = subjectCategories[sanitizedData.subject as keyof typeof subjectCategories] || 'üí¨';\n    \n    // Create email content\n    const emailContent = {\n      to: process.env.NGIMALAYA_EMAIL || 'ngiman81@gmail.com',\n      from: {\n        email: process.env.NGIMALAYA_EMAIL || 'ngiman81@gmail.com',\n        name: 'Ngimalaya Adventure Inquiry System'\n      },\n      replyTo: sanitizedData.email,\n      subject: `${subjectIcon} Inquiry: ${sanitizedData.subject} - ${sanitizedData.fullName}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }\n            .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }\n            .section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }\n            .section-title { color: #4facfe; font-size: 18px; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #4facfe; padding-bottom: 5px; }\n            .field { margin-bottom: 12px; }\n            .label { font-weight: bold; color: #555; display: inline-block; min-width: 150px; }\n            .value { color: #333; }\n            .subject-badge { display: inline-block; background: #4facfe; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; margin: 10px 0; }\n            .message-box { background: #f8f9fa; padding: 20px; border-left: 4px solid #4facfe; margin: 15px 0; white-space: pre-wrap; line-height: 1.8; }\n            .priority { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 15px 0; }\n            .footer { text-align: center; margin-top: 20px; color: #666; font-size: 12px; }\n            .action-buttons { margin: 20px 0; }\n            .btn { display: inline-block; padding: 12px 24px; background: #4facfe; color: white; text-decoration: none; border-radius: 6px; margin: 5px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1>${subjectIcon} New Inquiry Received</h1>\n              <p>Received: ${new Date().toLocaleString('en-US', { timeZone: 'Asia/Kathmandu' })} NPT</p>\n            </div>\n            \n            <div class=\"content\">\n              <div class=\"section\">\n                <div class=\"section-title\">üë§ Contact Information</div>\n                <div class=\"field\"><span class=\"label\">Name:</span> <span class=\"value\">${sanitizedData.fullName}</span></div>\n                <div class=\"field\"><span class=\"label\">Email:</span> <span class=\"value\"><a href=\"mailto:${sanitizedData.email}\">${sanitizedData.email}</a></span></div>\n                ${sanitizedData.phone ? `<div class=\"field\"><span class=\"label\">Phone:</span> <span class=\"value\">${sanitizedData.phone}</span></div>` : ''}\n              </div>\n              \n              <div class=\"section\">\n                <div class=\"section-title\">üìå Inquiry Details</div>\n                <div class=\"field\">\n                  <span class=\"label\">Category:</span><br>\n                  <span class=\"subject-badge\">${sanitizedData.subject}</span>\n                </div>\n              </div>\n              \n              <div class=\"section\">\n                <div class=\"section-title\">üí¨ Message</div>\n                <div class=\"message-box\">${sanitizedData.message}</div>\n              </div>\n              \n              <div class=\"priority\">\n                <strong>‚ö†Ô∏è Action Required:</strong> Please respond to this inquiry within 24 hours to maintain excellent customer service.\n              </div>\n              \n              <div class=\"action-buttons\">\n                <a href=\"mailto:${sanitizedData.email}\" class=\"btn\">Reply to Customer</a>\n              </div>\n              \n              <div class=\"footer\">\n                <p>This email was sent from Ngimalaya Adventure inquiry system</p>\n                <p>IP Address: ${clientIP}</p>\n                <p style=\"margin-top: 10px; font-size: 10px; color: #999;\">\n                  Security: Email validated, Content sanitized, Rate limited\n                </p>\n              </div>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n      text: `\nNew Inquiry Received\n\nContact Information:\n- Name: ${sanitizedData.fullName}\n- Email: ${sanitizedData.email}\n${sanitizedData.phone ? `- Phone: ${sanitizedData.phone}` : ''}\n\nInquiry Details:\n- Category: ${sanitizedData.subject}\n\nMessage:\n${sanitizedData.message}\n\nReceived: ${new Date().toLocaleString()}\nIP Address: ${clientIP}\n\nPlease respond within 24 hours.\n      `\n    };\n    \n    await sgMail.send(emailContent);\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Inquiry submitted successfully'\n    });\n    \n  } catch (error: unknown) {\n    console.error('Inquiry API Error:', error);\n    \n    if (error instanceof Error && error.message === 'Suspicious content detected') {\n      return NextResponse.json(\n        { error: 'Invalid input detected' },\n        { status: 400 }\n      );\n    }\n    \n    return NextResponse.json(\n      { error: 'Failed to submit inquiry. Please try again.' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}